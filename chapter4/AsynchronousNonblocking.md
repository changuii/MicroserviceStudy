# 4.5 비동기식 논블로킹

비동기식 통신을 사용하면, 네트워크를 통해 호출을 보내는 행위가 호출하는 마이크로서비스를 블로킹하지 않는다.  
따라서 응답을 기다릴 필요 없이 다른 처리를 계속할 수 있다.  
비동기식 논블로킹 통신은 다양한 형태로 제공되지만 여기서는 마이크로서비스 아키텍처에서 가장 일반적인 세 가지 방식을 자세히 살펴본다.  


`공통 데이터를 통한 통신`  
- 업스트림 마이크로서비스는 일부 공통 데이터를 변경하고 이 데이터는 나중에 하나 이상의 마이크로서비스에서 사용된다.  

`요청 및 응답`
- 마이크로서비스는 다른 마이크로서비스에 작업 요청을 보낸다.  
- 요청된 작업이 완료되면 성공 여부와 관계없이 업스트림 마이크로서비스는 응답을 수신한다.  
- 특히, 업스트림 마이크러시브스의 어떤 인스턴스도 응답을 처리할 수 있어야 한다.  

`이벤트 기반 상호작용`
- 마이크로서비스는 발행한 일에 대한 사실적 진술로 생각될 수 있는 이벤트를 브로드캐스트 한다.  
- 다른 마이크로서비스는 관심 있는 이벤트를 수신하고 적절히 대응한다.  

## 4.5.1 장점

비동기식 논블로킹 통신을 사용하면 초기 호출을 수행하는 마이크로서비스와 호출을 수신하는 마이크로서비스는 일시적으로 분리된다.  
호출을 수신하는 마이크로서비스가 호출과 동시에 연결될 필요는 없다.  

이러한 통신 방식은 호출에 의해 트리거되는 기능을 처리하는 데 오랜 시간이 걸리는 경우에도 유용하다.  
뮤직코프의 예에서 패키지를 발송하는 특정 프로세스로 돌아가보자.  

주문처리기는 지불을 받고 패키지를 발송할 때라고 판단해 창고 마이크로서비스에 호출을 보낸다.  
CD를 찾고, 선반에서 꺼내고, 포장하고, 픽업하는 프로세스는 실제 발송 프로세스의 동작 방식에 따라 몇 시간이 걸릴 수 있고 심지어는 며칠이 소요될 수 있다.  
따라서 주문처리기가 창고 서비스에 대한 비동기식 논블로킹 호출을 하고 이후 창고 서비스가 역호출(call back)해 주문 처리기에 진행 상황을 알리는 것이 적절하다.  
이것이 바로 비동기 요청 및 응답 통신의 한 예이다.  

동기식 블로킹 호출과 유사한 방식으로 시도했다면 주문 처리기와 창고 서비스 간의 상호작용을 재구성해야 한다.  
즉, 주문 처리기가 커넥션을 열어 요청을 보내고, 호출한 스레드에서 추가 작업을 막고, 몇 시간 또는 며칠이 될지 모르는 응답을 기다리는 것은 실현 가능성이 없다.  

## 4.5.2 단점  

동기식 블로킹 통신과 비교해 비동기식 논블로킹 통신의 주요 단점은 복잡도와 선택 범위에 있다.  
이미 설명했듯이 선택 가능한 비동기 통신 방식은 다양하다.  
그중 여러분에게 적합한 방식은 어떤 것일까?  
비동기식 통신이 컴퓨팅에 대한 여러분의 사고 모델에 맞지 않는다면 비동기식 통신 방식을 채택하기는 어려울 것이다.  


## 4.5.3 적용 대상

궁극적으로 비동기식 통신이 여러분에게 적합한지를 고려한다면, 유형마다 장단점이 있으므로 어떤 유형의 비동기식 통신을 선택할지도 고려해야 한다.  
하지만 일반적으로 비동기식 통신을 사용해야 하는 특정 사용 사례가 몇 가지 있다.  

앞에서 살펴본 뮤직코프의 예시인 장기 수행 프로세스는 명백한 비동기 통신 후보이다.  
또한 재구성하기 쉽지 않은 긴 호출 체인이 있는 상황도 좋은 후보가 될 수 있다.  
가장 일반적인 세 가지 비동기 통신 형태인 요청 및 응답 호출, 이벤트 기반 통신, 공통 데이터를 통한 통신 방식을 탐구해보자.  



