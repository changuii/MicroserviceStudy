# 2.2 올바른 마이크로서비스 경계를 만드는 것은 무엇인가?  

우리는 마이크로서비스가 독립적인 방식으로 변경되거나 배포돼 이 서비스의 기능이 사용자에게 릴리스되길 바란다.  
한 마이크로서비스를 다른 마이크로서비스와 별개로 변경할 수 잇는 능력은 매우 중요하다.  
그렇다면 마이크로서비스 주변의 경계를 정하는 방법을 생각할 때는 어떤 점을 염두에 둬야 할까?  

본질적으로 마이크로서비스는 모델과 모든 연관된 문제 사이에서 네트워크 기반의 상호작용이 이뤄지더라도 결국 모듈식 분해의 또 다른 형태일 뿐이다.  
다행히도 이러한 사실은 경계를 정의하는 방법을 찾는 데 모듈식 소프트웨어와 구조적 프로그래밍 영역에 존재하는 많은 선행 기술에 의지할 수 있다는 것을 의미한다.  

## 2.2.1 정보 은닉  

정보 은닉은 모듈 경계를 정의하는 가장 효과적인 방법을 찾으려고 데이비드 파나스가 만든 개념이다.  
정보 은닉은 모듈(마이크로서비스) 경계 뒤에 가능한 한 많은 세부 정보를 숨기려는 욕구를 나타낸다.  

`향상된 개발 시간`
- 모듈을 독립적으로 개발함에 따라 더 많은 작업을 병렬로 수행할 수 있고, 프로젝트에 더 많은 개발자를 추가하는데 따른 영향을 줄일 수 있다.  

`이해도`
- 각 모듈을 따로따로 살펴보고 이해할 수 있다. 
- 이는 시스템 전체가 수행하는 자겁을 더 쉽게 이해하도록 해준다.  

`유연성`
- 모듈은 서로 독립적으로 변경 가능하므로 다른 모듈을 변경하지 않고도 시스템 기능을 변경할 수 있다.  
- 게다가 모듈을 다양한 방식으로 결합해 새로운 기능을 제공할 수 있다.  

이러한 매력적인 특징은 마이크로서비스 아키텍처를 통해 성취하려는 것을 훌륭하게 완성한다.  
사실 필자는 이제 마이크로서비스를 모듈식 아키텍처의 한 형태로 간주한다.  

파나스의 연구에서 정보 은닉은 모듈식 아키텍처를 최대한 활용하는 데 도움이 되는 핵심 기법이었고, 현대적인 관점에서 보면 마이크로서비스에도 동일하게 적용된다.  
파나스의 다른 논문에는 주옥같은 문구가 있다.  

`모듈 간 연결은 모듈이 서로에게 만드는 가정(추정, assumption)이다.`

하나의 모듈이 다른 모듈에 대해 만드는 가정의 수를 줄임으로써 모듈 간의 연결에 직접적으로 영향을 미친다.  
가정의 수를 작게 유지하면 다른 모듈에 영향을 미치지 않고 하나의 모듈을 변경하기가 더 쉽다.  

모듈을 변경하는 개발자가 다른 사람들이 해당 모듈을 어떻게 사용하는지 명확히 이해하고 있다면, 업스트림 호출자도 변경할 필요가 없는 방식으로 안전하게 변경하도록 만들 가능성이 더 높을 것이다.  

이는 마이크로서비스에도 적용된다.  
다른 것을 배포할 필요 없이 변경된 마이크로서비스를 배포할 수 있다는 점에서 파나스가 설명한 향상된 개발 시간, 이해도, 유연성이라는 세 가지 바람직한 특징을 더욱 증폭시킬 수 있다.  

정보 은닉의 의미는 매우 다양한 방식으로 전개되며, 이 책 전반에서 해당 주제를 다룬다.  

## 2.2.2 응집력  

응집력을 나타내는 가장 간결한 정의 중 하나는 '함께 바뀌고 함께 머무는 코드'다.  
이는 우리의 목적을 고려할 때 상당히 좋은 정의다.  

이미 설명했듯이 우리는 비즈니스 기능을 쉽게 변경할 수 있도록 마이크로서비스 아키텍처를 최적화하려 한다.  
따라서 가능한 한 적은 장소에서 변경할 수 있는 방식으로 기능을 그룹으로 묶으려고 한다.  

관련성 있는 행동은 함께 두길 원하고, 그렇지 않은 행동은 다른 곳에 두길 원한다 왜 그럴까?  
아마도 행동을 바꾸려 할 때 한곳에서 바꾸길 원하고 가능한 한 빠르게 그 변경을 릴리스하길 원해서다.  

여러 곳에서 그 행동을 변경해야 한다면 이 변경 사항을 제공하기 위해 많은 다른 서비스를 릴리스해야할 것이다.  
여러 곳에서 변경하는 것은 느리고 한 번에 많은 서비스를 배포하는 것은 위험하므로 두 가지 다 피하고 싶다.  

따라서 문제 영역 내에서 관련 동작을 한 곳으로 모으며, 다른 경게와 가능한 한 느슨하게 통신할 수 있는 경계를 찾길 원한다.  
관련된 기능이 시스템 전체에 분산돼 있으면 응집력이 약하다고 말할 수 있지만, 마이크로서비스 아키텍처는 강한 응집력을 목표로 한다.  


## 2.2.3 결합  

서비스가 느슨하게 결합됐다면 한 서비스를 변경할 때 다른 서비스를 변경할 필요가 없다.  
마이크로서비스의 핵심은 시스템의 다른 부분을 변경하지 않고도 한 서비스를 변경하고 배포할 수 있다는 것이며, 이 점은 매우 중요하다.  

그렇다면 어떤 종류가 강한 결합을 유발할까?  
이와 관련된 전형적인 실수는 한 서비스를 다른 서비스에 단단히 결합하는 통합 방식을 선택해 서비스 내부가 변경되면 소비자도 변경하도록 요구하는 것이다.  

느슨하게 결합된 서비스는 함께 협업하는 서비스들에 대해 꼭 필요한 만큼만 알고 있다.  
또한 우리는 한 서비스에서 다른 서비스로 다양한 유형의 호출 수를 제한하려 하는데, 이는 잠재적인 성능 문제 외에도 과도한 커뮤니케이션이 강한 결합을 초래할 수 있기 때문이다.  

하지만 결합은 다양한 형태로 발생되므로 서비스 기반 아키텍처와 관련된 특성을 잘못 이해하는 경우를 흔히 목격했다.  
따라서 이 점을 염두에 두고 이 주제를 살펴보자.  

## 2.2.4 결합과 응집력의 연관성  

이전에 다뤘듯이 결합과 응집력은 개념적으로 분명 관련이 있다.  
논리적으로 연관된 기능이 시스템 전체에 분산돼 있다면, 이 기능에 대한 변경은 이러한 경계를 넘어 전파돼 더 긴밀한 결합을 나타낸다.  
구조적 설계의 선구자인 래리 콘스탄틴의 이름을 따서 명명된 콘스탄틴의 법칙은 이 연관성을 다음과 같이 깔끔하게 요약한다.  

`응집력이 강하고 결합도가 낮으면 구조가 안정된다.`  

여기서 안정성 개념은 중요하다.  
독립적인 배포 가능성을 기반으로 제공하는 마이크로서비스 경계에서 마이크로서비스를 병렬로 작업하고 협업하는 팀 간의 조정 작업량을 줄이려면, 경계 자체에 어느 정도의 안정성은 필요하다.  

마이크로서비스가 제공하는 계약이 하위 호환성을 깨뜨리는 방식으로 계속 변경된다면 상위 소비자도 지속적으로 변경해야 할 것이다.  

결합도와 응집력은 깊이 관련돼 있으며, 적어도 어느 정도 수준에서는 두 개념이 사물 간의 관계를 설명한다는 점에서 분명히 동일하다.  

응집력은 경계 내부에 있는 사물 사이의 관계에 적용되는 반면,  
결합은 경계 건너에 있는 사물 간의 관계를 설명한다.  

코드를 구성하는 데 절대적으로 가장 좋은 방법이란 존재하지 않는다.  
결합과 응집력은 코드를 그룹화할 위치와 그 이유에 대해 다양한 절충안을 명확히 하는 한 가지 방법일 뿐이다.  
주어진 맥락과 현재 직면하고 있는 문제에 대해 가장 적합한 것을 찾으려면 이 두 개념 사이에서 올바른 균형을 잡아야 한다.  

세상은 고정돼 있지 않다는 점을 기억하라.  
즉 시스템은 요구사항이 변경됨에 따라 다시 결정해야 할 이요도 나타날 수 있다.  





